{% extends 'base.html' %}
{% load static %}
{% load courses_tags %}
{% load cloudinary %}

{% block head_title %}{{ course_detail.title }} - MindJunkies{% endblock %}

{% block main_content %}
    <div class="bg-base-200 min-h-screen pb-12">
    <!-- Course Header -->
    <div class="bg-black text-primary-content py-16">
        <div class="container mx-auto px-4 max-w-7xl">
            <div class="flex flex-col lg:flex-row justify-between items-start">
                <div class="lg:w-2/3 mb-6 lg:mb-0 lg:pr-8">
                    <h1 class="text-4xl font-bold mb-4">{{ course_detail.title }}</h1>
                    <p class="text-xl mb-6">{{ course_detail.short_introduction }}</p>
                    <div class="flex flex-wrap items-center gap-4 mb-6">
                        <div class="badge badge-secondary">{{ course_detail.category }}</div>
                        <div class="flex items-center">
                            <span class="text-yellow-400 mr-1">â˜…</span>
                            <span>{{ course_detail.total_rating }} ({{ course_detail.number_of_ratings }} reviews)</span>
                        </div>
                        <div>{{ course_detail.get_total_enrollments }} students enrolled</div>
                    </div>
                    <div class="flex items-center mb-4">
                        <img src="




                            {% if user.profile.avatar %}{{ user.profile.avatar.url }}{% else %}{% static 'images/default-avatar.png' %}{% endif %}"
                             alt="{{ course_detail.teacher.username }}" class="w-12 h-12 rounded-full mr-4">
                        <div>
                            <p>Created by  </p>
                            <p class="font-semibold">{{ course_detail.teacher.name }}</p>
                        </div>
                    </div>
                    <div class="flex flex-wrap gap-4">
                        <div class="flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20"
                                 fill="currentColor">
                                <path fill-rule="evenodd"
                                      d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z"
                                      clip-rule="evenodd"/>
                            </svg>
                            Last updated - {{ course_detail.updated_at|date:"F Y" }}
                        </div>
                        <div class="flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20"
                                 fill="currentColor">
                                <path fill-rule="evenodd"
                                      d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z"
                                      clip-rule="evenodd"/>
                            </svg>
                            {{ course_detail.language }} English
                        </div>
                        <div class="flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20"
                                 fill="currentColor">
                                <path
                                    d="M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z"/>
                            </svg>
                            {{ course_detail.level }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Course Content -->
    <div class="container mx-auto px-4 max-w-7xl py-12">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Main Content -->
            <div class="lg:col-span-2">

                <!-- What you'll learn -->
                

                <!-- Course content -->
                <body class="bg-slate-50 min-h-screen py-8 px-4 my-8">
                    <div class="max-w-4xl mx-auto">
                      <div class="card bg-base-100 shadow-lg border border-base-200">
                        <div class="card-body p-6">
                          <!-- Title Area -->
                          <div class="border-b border-base-200 pb-4 mb-6">
                            <h2 class="text-2xl font-bold  mb-4">Course content</h2>
                            <div class="flex flex-wrap gap-6 text-sm">
                              <div class="badge badge-lg badge-outline badge-primary gap-2 p-3">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                                </svg>
                                {{ course_detail.modules.count }} Modules
                              </div>
                              <div class="badge badge-lg badge-outline badge-primary gap-2 p-3">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z" />
                                </svg>
                                {{ num_lectures }} Lectures
                              </div>
                              
                            
                            </div>
                          </div>
                          
                          <!-- Sections Accordion -->
                          <div class="space-y-4">
                            {% for section in course_detail.modules.all %}
                              <div x-data="{ open: false }" class="collapse collapse-arrow bg-base-100 border border-base-200 ">
                                <input type="checkbox" @click="open = !open" class="peer" /> 
                                <div class="collapse-title bg-base-100 flex items-center text-lg font-medium">
                                  <span class="">{{ section.title }}</span>
                                </div>
                                <div class="collapse-content bg-base-100">
                                  <ul class="menu bg-base-100 w-full ">
                                    {% for lecture in section.lectures.all %}
                                      <li class="border-b border-base-200 last:border-b-0">
                                        <div class="flex justify-between items-center py-2 hover:bg-base-200 transition-all duration-200 rounded-lg px-3">
                                          <div class="flex items-center gap-3">
                                            <div class="avatar placeholder">
                                              <div class="bg-primary text-primary-content flex items-center rounded-full">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                                                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                </svg>
                                              </div>
                                            </div>
                                            <span class="font-medium">{{ lecture.title }}</span> 
                                          </div>
                                          <div class="flex gap-3">
                                           
                                              <div class="badge badge-ghost gap-1">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
                                                </svg>
                                                {{ lecture.videos.count }} video{% if lecture.videos.count != 1 %}s{% endif %}
                                              </div>
                                            
                                            
                                              <div class="badge badge-ghost gap-1">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                                                </svg>
                                                {{ lecture.pdf_files.count|default:"0" }} attachment{% if lecture.pdf_files.count != 1 %}s{% endif %}
                                              </div>
                                           
                                          </div>
                                        </div>
                                      </li>
                                    {% endfor %}
                                  </ul>
                                </div>
                              </div>
                            {% endfor %}
                          </div>
                        </div>
                      </div>
                    </div>
                  </body>

                <!-- Requirements -->
               

                <!-- Description -->
                <div class="card bg-base-100 shadow-xl mb-8">
                    <div class="card-body">
                        <h2 class="card-title text-2xl mb-4">Description</h2>
                        <div class="prose max-w-none">
                            {{ course_detail.course_description | markdown }}
                        </div>
                    </div>
                </div>

                <!-- Instructor -->
                <div class="card bg-base-100 shadow-xl mb-8">
                    <div class="card-body">
                        <h2 class="card-title text-2xl mb-4">Instructor</h2>
                        <div class="flex items-center mb-4">
                            <img src="











                                {% if user.profile.avatar %}{{ user.profile.avatar.url }}{% else %}{% static 'images/default-avatar.png' %}{% endif %}"
                                 alt="{{ instructor.username }}" class="w-24 h-24 rounded-full mr-6">
                            <div>
                                <h3 class="text-xl font-semibold mb-2">{{ course_detail.teacher.name }}</h3>
                                <p class="text-base-content/70">{{ course_detail.teacher.title }}</p>
                            </div>
                        </div>
                        <div class="flex flex-wrap gap-4 mb-4">
                            <div class="flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20"
                                     fill="currentColor">
                                    <path
                                        d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                                </svg>
                                {{ course_detail.teacher.get_instructor_rating|floatformat:1 }} Instructor Rating
                            </div>
                            <div class="flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20"
                                     fill="currentColor">
                                    <path
                                        d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"/>
                                </svg>
                                {{ course_detail.teacher.get_number_of_reviews }} Reviews
                            </div>
                            <div class="flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20"
                                     fill="currentColor">
                                    <path
                                        d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z"/>
                                </svg>
                                {{ course_detail.teacher.get_number_of_students }} Students
                            </div>
                            <div class="flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20"
                                     fill="currentColor">
                                    <path fill-rule="evenodd"
                                          d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm3 2h6v4H7V5zm8 8v2h1v-2h-1zm-2-2H7v4h6v-4zm2 0h1V9h-1v2zm1-4V5h-1v2h1zM5 5v2H4V5h1zm0 4H4v2h1V9zm-1 4h1v2H4v-2z"
                                          clip-rule="evenodd"/>
                                </svg>
                                {{ course_detail.teacher.get_number_of_courses }} Courses
                            </div>
                        </div>
                        <p class="mb-4">{{ course_detail.instructor.bio }}</p>
                    </div>
                </div>
                <!-- Reviews -->
                <div class="card bg-base-100 shadow-xl mb-8">
                    <div class="card-body">
                        <h2 class="card-title text-2xl mb-4">Student Reviews</h2>

                        <!-- Review Summary -->
                        <div class="card bg-base-200">
                            <div class="card-body">
                                <div class="flex flex-col md:flex-row gap-8">
                                    <!-- Rating Overview using stats -->
                                    <div class="stats bg-primary text-white shadow">
                                        <div class="stat">
                                            <div class="stat-title text-white">Course Rating</div>
                                            <div class="stat-value text-4xl">{{ course_detail.total_rating }}</div>
                                            <div class="stat-desc mt-2">
                                                <div class="rating rating-md">
                                                    <input type="radio" name="rating-7"
                                                           class="mask mask-star-2 bg-yellow-400" checked disabled/>
                                                    <input type="radio" name="rating-7"
                                                           class="mask mask-star-2 bg-yellow-400" checked disabled/>
                                                    <input type="radio" name="rating-7"
                                                           class="mask mask-star-2 bg-yellow-400" checked disabled/>
                                                    <input type="radio" name="rating-7"
                                                           class="mask mask-star-2 bg-yellow-400" checked disabled/>
                                                    <input type="radio" name="rating-7"
                                                           class="mask mask-star-2 bg-yellow-400" checked disabled/>
                                                </div>
                                            </div>
                                            <div class="stat-desc mt-1 text-white">Based
                                                on {{ course_detail.number_of_ratings }} reviews
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Rating Distribution -->
                                    <div class="flex-1">
                                        <h4 class="font-medium mb-4">Rating Distribution</h4>
                                        <div class="space-y-4">
                                            {% for star, percentage in course_detail.get_rating_distribution.items %}
                                                <div class="flex items-center gap-3">
                                                    <div class="w-16 text-sm">{{ star }} stars</div>
                                                    <div class="flex-1">
                                                        <progress class="progress progress-warning w-full"
                                                                  value="{{ percentage }}" max="100"></progress>
                                                    </div>
                                                    <div class="w-12 text-sm text-right">{{ percentage|floatformat:0 }}%
                                                    </div>
                                                </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Individual Reviews -->
                        <div class="space-y-6">
                            {% for rating in ratings %}
                                <div class="border-base-300 pb-6">
                                    <div class="flex items-start gap-4">
                                        <img
                                            src="https://ui-avatars.com/api/?name={{ rating.student.username }}&background=random"
                                            alt="Student"
                                            class="w-12 h-12 rounded-full">
                                        <div class="flex-1">
                                            <h4 class="font-semibold">{{ rating.student.username }}</h4>
                                            <div class="flex text-yellow-400 my-1">
                                                {% for i in rating.rating|times %}
                                                    <span>â˜…</span>
                                                {% endfor %}
                                                {% for i in 5|subtract:rating.rating|times %}
                                                    <span>â˜†</span>
                                                {% endfor %}
                                            </div>
                                            <div
                                                class="text-sm text-base-content/70 mb-2">{{ rating.created_at|date:"F j, Y" }}</div>
                                            <p>{{ rating.review }}</p>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                            <div class="flex justify-center gap-4">
                                <div class="btn-group">
                                    {% if ratings.has_previous %}
                                        <a href="?page=1" class="btn btn-sm">&laquo; First</a>
                                        <a href="?page={{ ratings.previous_page_number }}"
                                           class="btn btn-sm">Previous</a>
                                    {% endif %}

                                    <span class="btn btn-sm btn-disabled">
            Page {{ ratings.number }} of {{ ratings.paginator.num_pages }}
        </span>

                                    {% if ratings.has_next %}
                                        <a href="?page={{ ratings.next_page_number }}" class="btn btn-sm">Next</a>
                                        <a href="?page={{ ratings.paginator.num_pages }}" class="btn btn-sm">Last
                                            &raquo;</a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- Teacher Actions -->
                {% if teacher %}
                    <div class="container mx-auto px-4 max-w-7xl mb-8">
                        <div class="card bg-base-100 shadow-xl">
                            <div class="card-body">
                                <h2 class="card-title text-2xl mb-4">Teacher Actions</h2>
                                <div class="flex gap-4">
                                    <a href="{% url 'edit_course' %}?slug={{ course_detail.slug }}"
                                       class="btn btn-primary">Edit
                                        Course</a>
                                    <a href="{% url 'lecture_home' course_detail.slug %}"
                                       class="btn btn-secondary">Manage
                                        Lectures</a>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}
            </div>

            <!-- Sidebar -->
            <div class="lg:col-span-1">
                <div class="sticky top-8 flex flex-col gap-8">
                    <div class="card bg-base-100 shadow-xl">
                        <div class="card-body">
                            {% if course_detail.preview_video_link %}
                                <div class="aspect-w-16 aspect-h-9 mb-4">
                                    <iframe class="rounded-lg w-full" src="{{ course_detail.preview_video_link }}"
                                            title="Course Preview"
                                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                            allowfullscreen></iframe>
                                </div>
                            {% else %}
                                <div class="w-full h-[200px] flex items-center justify-center bg-gradient-to-br from-gray-50 to-blue-50">
                                    {% cloudinary course_detail.course_image fetch_format="auto" quality="auto" width=300 height=200 crop="pad" background="auto" class="rounded-t-2xl object-contain transition-all duration-700 ease-in-out transform group-hover:scale-110" %}
                                </div>
                            {% endif %}
                            <div class="text-3xl font-bold mb-4">${{ course_detail.course_price }}</div>

                            {% if student %}
                                <a href="{% url 'lecture_home' course_detail.slug %}
                             " class="btn btn-primary btn-block mb-4">View</a>
                             {% elif course_detail.teacher == request.user %}
                                <a href="{% url 'lecture_home' course_detail.slug %}"
                                   class="btn btn-primary btn-block mb-4">Manage Course</a>
                            {% else %}
                                <a href="{% url 'checkout' course_detail.slug %}"
                                   class="btn btn-primary btn-block mb-4">Enroll</a>
                            {% endif %}
                            {% comment %} <a href="{{ course_detail.preview_video_link }}" class="btn btn-outline btn-block mb-4"
                               target="_blank">Watch Preview</a> {% endcomment %}
                            <p class="text-center text-sm mb-4">30-Day Money-Back Guarantee</p>
                        </div>
                    </div>
                    <div class="card bg-base-100 shadow-xl">
                        <div class="card-body">
                            <h3 class="font-semibold text-lg mb-4">This course includes:</h3>
                            <div class="space-y-2">
                                <div class="flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20"
                                         fill="currentColor">
                                        <path fill-rule="evenodd"
                                              d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"
                                              clip-rule="evenodd"/>
                                    </svg>
                                    {{ course_detail.total_length }} of on-demand video
                                </div>
                                <div class="flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20"
                                         fill="currentColor">
                                        <path fill-rule="evenodd"
                                              d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z"
                                              clip-rule="evenodd"/>
                                    </svg>
                                    {{ course_detail.num_articles }} articles
                                </div>
                                <div class="flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20"
                                         fill="currentColor">
                                        <path
                                            d="M10 3.5a1.5 1.5 0 013 0V4a1 1 0 001 1h3a1 1 0 011 1v3a1 1 0 01-1 1h-.5a1.5 1.5 0 000 3h.5a1 1 0 011 1v3a1 1 0 01-1 1h-3a1 1 0 01-1-1v-.5a1.5 1.5 0 00-3 0v.5a1 1 0 01-1 1H6a1 1 0 01-1-1v-3a1 1 0 00-1-1h-.5a1.5 1.5 0 010-3H4a1 1 0 001-1V6a1 1 0 011-1h3a1 1 0 001-1v-.5z"/>
                                    </svg>
                                    {{ course_detail.num_resources }} downloadable resources
                                </div>
                                <div class="flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20"
                                         fill="currentColor">
                                        <path fill-rule="evenodd"
                                              d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z"
                                              clip-rule="evenodd"/>
                                    </svg>
                                    Full lifetime access
                                </div>
                                <div class="flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20"
                                         fill="currentColor">
                                        <path fill-rule="evenodd"
                                              d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                              clip-rule="evenodd"/>
                                    </svg>
                                    Certificate of completion
                                </div>
                            </div>
                        </div>
                    </div>


                </div>
            </div>


        </div>
    </div>
{% endblock main_content %}
