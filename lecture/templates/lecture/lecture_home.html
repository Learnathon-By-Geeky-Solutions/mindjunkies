{% extends 'base.html' %}
{% load static %}

{% block main_content %}
<div class="drawer lg:drawer-open">
  <input id="my-drawer" type="checkbox" class="drawer-toggle" />
  <div class="drawer-content flex flex-col h-screen">
    <!-- Page content here -->
    <div class="navbar bg-base-100 lg:hidden">
      <div class="flex-none">
        <label for="my-drawer" class="btn btn-square btn-ghost drawer-button">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="inline-block w-5 h-5 stroke-current"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
        </label>
      </div>
      <div class="flex-1">
        <a class="btn btn-ghost normal-case text-xl">{{ course.title }}</a>
      </div>
    </div>
    
    <!-- Main Content -->
    <main class="flex-1 overflow-y-auto p-4 lg:p-8">
      <!-- Breadcrumb Navigation -->
      <div class="text-sm breadcrumbs mb-4">
        <ul>
          <li><a>{{ course.title }}</a></li>
          <li><a>Week {{ current_week.number }}</a></li>
          <li>{{ current_week.title }}</li>
        </ul>
      </div>

      <!-- Week Overview -->
      <div class="bg-base-200 rounded-lg p-4 lg:p-6 mb-8">
        <h2 class="text-xl font-semibold mb-4">Week {{ current_week.number }}: {{ current_week.title }}</h2>
        <div class="flex flex-col lg:flex-row gap-4 lg:gap-6 text-sm text-base-content/70">
          <div class="flex items-center gap-1">
            <svg class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z" />
            </svg>
            <span>{{ current_week.video_duration }} of videos left</span>
          </div>
          <div class="flex items-center gap-1">
            <svg class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z" />
            </svg>
            <span>{{ current_week.reading_duration }} of readings left</span>
          </div>
          <div class="flex items-center gap-1">
            <svg class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor">
              <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z" />
            </svg>
            <span>{{ current_week.assessments_count }} graded assessments left</span>
          </div>
        </div>
      </div>

      <!-- Week Content -->
      <div class="prose max-w-none">
        <p class="text-base-content/70">{{ current_week.description }}</p>
        
        <!-- Learning Objectives -->
        <div class="collapse collapse-arrow bg-base-200 rounded-box mt-4">
          <input type="checkbox" id="learning-objectives-accordion" /> 
          <div class="collapse-title text-xl font-medium">Learning Objectives</div>
          <div class="collapse-content"> 
            <ul class="list-disc pl-5 space-y-2">
              <li>{{ current_week.content }}</li>
            </ul>
          </div>
        </div>

        <!-- Attachments -->
        <div class="mt-8">
          <div class="collapse collapse-arrow bg-base-200 rounded-box">
            <input type="checkbox" checked /> 
            <div class="collapse-title text-lg font-semibold">Attachments</div>
            <div class="collapse-content">
              <div class="space-y-4">
                {% for item in current_week.pdf_files.all %}
                <div class="flex items-center gap-1 p-1 hover:bg-base-300 rounded-lg cursor-pointer">
                  <svg class="h-6 w-6 mt-1 flex-shrink-0" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z" />
                  </svg>
                  <div class="flex-1 min-w-0">
                    <h4 class="font-medium truncate">
                      <a href="{% url 'lecture_pdf_content' current_week.slug item.id %}" class="text-primary hover:underline" target="_blank">
                        {{ item.pdf_title}}
                      </a>
                    </h4>
                    <p class="text-sm text-base-content/60">PDF File</p>
                  </div>
                </div>
                {% endfor %}
              </div>
            </div>
          </div>
        </div>

        <!-- Video Content -->
        <div class="mt-3">
          <div class="collapse collapse-arrow bg-base-200 rounded-box">
            <input type="checkbox" checked /> 
            <div class="collapse-title text-lg font-semibold">Video Content</div>
            <div class="collapse-content">
              <div class="space-y-2">
                {% for item in current_week.videos.all %}
                <div class="flex items-center gap-4 p-2 hover:bg-base-300 rounded-lg cursor-pointer">
                  <svg class="h-5 w-5 flex-shrink-0" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z" />
                  </svg>
                  <div class="flex-1 min-w-0">
                    <h4 class="font-medium truncate">
                      <a href="{% url 'lecture_video_content' current_week.slug item.id %}" class="text-primary hover:underline" target="_blank">
                        {{ item.video_title}}
                      </a>
                    </h4>
                    <p class="text-sm text-base-content/60">Video File</p>
                  </div>
                </div>
                {% endfor %}
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div> 
  <div class="drawer-side h-screen">
    <label for="my-drawer" class="drawer-overlay"></label>
    <aside class="w-80 bg-base-100 border-r flex-shrink-0">
      <!-- Sidebar content here -->
      <div class="p-4">
        <h2 class="font-bold text-lg mb-4">{{ course.title }}</h2>
        
        <nav class="space-y-2 h-screen">
          <div class="collapse collapse-arrow bg-base-200 rounded-md">
            <input type="checkbox" checked /> 
            <div class="collapse-title font-medium">Course Material</div>
            <div class="collapse-content">
              {% for lecture in course.lectures.all %}
              <a href="{% url 'lecture_home' course.id %}?lecture_id={{lecture.id }}" class="block py-2 px-4 hover:bg-base-300 rounded-md {% if lecture.is_current %}text-primary bg-primary/10{% endif %}">
                Module {{ lecture.order }}
              </a>
              {% endfor %}
            </div>
          </div>
          <a href="#" class="block py-2 px-4 hover:bg-base-200 rounded-md">Grades</a>
          <a href="#" class="block py-2 px-4 hover:bg-base-200 rounded-md">Notes</a>
          <a href="#" class="block py-2 px-4 hover:bg-base-200 rounded-md">Messages</a>
          <a href="#" class="block py-2 px-4 hover:bg-base-200 rounded-md">Course Info</a>
        </nav>
      </div>
    </aside>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const drawer = document.getElementById('my-drawer');
    const mediaQuery = window.matchMedia('(min-width: 1024px)');

    function handleDrawerState(e) {
      if (e.matches) {
        drawer.checked = true;
      } else {
        drawer.checked = false;
      }
    }

    mediaQuery.addListener(handleDrawerState);
    handleDrawerState(mediaQuery);

    const showObjectivesButton = document.getElementById('learning-objectives-accordion');
    const learningObjectivesAccordion = document.getElementById('learning-objectives-accordion');
    
    if (showObjectivesButton && learningObjectivesAccordion) {
      showObjectivesButton.addEventListener('click', function() {
        learningObjectivesAccordion.checked = !learningObjectivesAccordion.checked;
      });
    }
  });
</script>
{% endblock %}

