{% extends 'base.html' %}

{% block main_content %}
  <h2>MCQ Exam</h2>

  <!-- Form for MCQ Generation -->
  <form method="POST">
    {% csrf_token %}
    <div class="form-group">
      <label for="text">Enter Text for MCQ Generation:</label>
      <textarea id="text" name="text" class="form-control" rows="4" cols="50" required>{{ input_text }}</textarea>
      <button type="submit" name="generate_questions" class="primary"
              style="background-color: #4CAF50; color: white; border: none; padding: 10px 20px;
                     text-align: center; text-decoration: none; display: inline-block; font-size: 16px;
                     cursor: pointer; border-radius: 5px; transition: background-color 0.3s;">
        Generate Questions
      </button>
    </div>
  </form>

  <br>

  {% if mcqs %}
    <h3>Generated Questions</h3>

    <!-- Form for Answer Submission -->
    <form method="POST">
      {% csrf_token %}

      {% for mcq in mcqs %}
        <fieldset>
          <legend>{{ mcq.question }}</legend>

          {% for option, answer in mcq.options.items %}
            <label>
              <input type="radio" name="answer_{{ forloop.parentloop.counter }}" value="{{ answer }}">
              {{ option }}) {{ answer }}
            </label><br>
          {% endfor %}
        </fieldset>
        <br>
      {% endfor %}

      <button type="submit" name="submit_answers" class="primary">Submit Answers</button>
    </form>
  {% else %}
    <p>No MCQs generated. Please provide input text above to generate questions.</p>
  {% endif %}

  {% if show_results %}
    <h3>Results</h3>
    <p><strong>Final Score:</strong> {{ score }} / {{ mcqs|length }}</p>

    {% for question, details in user_answers.items %}
    <fieldset 
    {% if details.is_correct %}
      style="border: 2px solid green; padding: 10px; border-radius: 5px;"
    {% else %}
      style="border: 2px solid red; padding: 10px; border-radius: 5px;"
    {% endif %}
  >
        <legend>{{ question }}</legend>
        <p><strong>Your Answer:</strong> {{ details.selected }}</p>
        <p><strong>Correct Answer:</strong> {{ details.correct }}</p>
      </fieldset>
      <br>
    {% endfor %}
  {% endif %}
{% endblock %}
